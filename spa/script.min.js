"use strict";function _typeof(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof=function(t){return typeof t}:_typeof=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(e)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){function o(e,t){try{var n=s[e](t),o=n.value}catch(f){i(f);return}n.done?r(o):Promise.resolve(o).then(u,a)}function u(e){o("next",e)}function a(e){o("throw",e)}var s=e.apply(t,n);u()})}}(window.preloadedScripts=window.preloadedScripts||[]).push(...['spa/components/address.jsx','spa/components/tag.jsx','spa/config/controller.js','spa/config/style.min.css','spa/config/view.jsx','spa/index/controller.js','spa/index/style.min.css','spa/index/view.jsx','spa/selectedTransaction/controller.js','spa/selectedTransaction/stepDetail.jsx','spa/selectedTransaction/style.min.css','spa/selectedTransaction/view.jsx','spa/transactions/controller.js','spa/transactions/style.min.css','spa/transactions/view.jsx']);var Address=function(t){var n=t.isContract,r=t.shorten,i=t.address,s=t.value;return React.createElement(React.Fragment,null,(n===!0||n!=="0x")&&React.createElement(React.Fragment,null,React.createElement("i",{className:"fa fa-file"})," "),React.createElement("a",{target:"_blank",href:window.getEtherscanAddress("address/"+s),onClick:function(t){return t.stopPropagation()}},r&&window.shortenWord(i,20),!r&&i))};var Tag=function(t){var n=t.color,r=t.icon,i=t.children,s=t.bold;return React.createElement("span",{className:"w3-tag w3-padding w3-round "+(n?n.indexOf("w3")===0?n:"w3-"+n:"w3-theme-l2")},r&&React.createElement(React.Fragment,null,React.createElement("i",{className:"fa fa-"+r})," "),s&&React.createElement("b",null,i),!s&&i)};var ConfigController = function(view) {
    var context = this;
    context.view = view;
};;var Config=React.createClass({displayName:"Config",refresh:function(){clearTimeout(this.getStateVar("refreshTimeoutId"));var t=this.getStateVar("file");if(!t)return;var n=this;fetch(URL.createObjectURL(t)).then(function(e){return e.text()}).then(function(e){return n.emit("dump",JSON.parse(e))}).then(function(){return n.setStateVar("refreshTimeoutId",0)})},render:function(){var t=this,n=useState(this,null,"file"),r=n[0],i=n[1],s=useState(this,5e3,"refreshTimeout"),o=s[0],u=s[1],a=useState(this,0,"refreshTimeoutId"),f=a[0],l=a[1];return useEffect(this,this.refresh,[r]),useEffect(this,function(){clearTimeout(f),l(setTimeout(t.refresh,o))},[o]),React.createElement("div",{className:"w3-theme-dark w3-bar w3-card-2"},React.createElement("label",{className:"w3-bar-item"},"Dump file:",React.createElement("input",{type:"file",accept:".json",onChange:function(t){i(t.currentTarget.files&&t.currentTarget.files.length>0?t.currentTarget.files[0]:null);try{t.currentTarget.value=""}catch(t){}try{t.currentTarget.files=(new DataTransfer).files}catch(t){}}})))}});var IndexController = function(view) {
    var context = this;
    context.view = view;

    context.onDump = async function onDump(dump) {
        delete window.chainId;
        window.chainId = dump?.chainId;
        view.setStateVar('transactions', []);
        view.setStateVar('selectedTransaction', null);
        var originalTransactions = dump.transactions.map(it => it);
        var transactions = JSON.parse(JSON.stringify(originalTransactions));
        for (var i in transactions) {
            var tx = {...transactions[i], i };
            var originalTransaction = {...originalTransactions[i], i };
            transactions[i] = context.attachParentAndTransaction(tx, tx, originalTransaction);
        }
        var additionalData = await context.prepareAdditionalData(dump.compiledContracts, dump.wellknownAddresses);
        if(!dump.transactionLabels || Object.values(dump.transactionLabels).length === 0 || !Object.values(dump.transactionLabels)[0]) {
            try {
                dump.transactionLabels = {
                    "Transactions - " : transactions[0].transactionHash
                }
            } catch(e) {
                delete dump.transactionLabels;
            }
        }
        dump.transactionLabels && (additionalData.transactionLists = prepareTransactionLists(dump.transactionLabels, transactions));
        view.setStateVar('additionalData', additionalData);
        view.setStateVar('transactions', transactions);
    };

    function prepareTransactionLists(transactionLabels, transactions) {
        var transactionLists = {};
        var keys = Object.keys(transactionLabels);
        for(var i = 1; i < keys.length; i++) {
            var key = keys[i - 1];
            transactionLists[key.endsWith(' - ') ? key.split(' - ')[0] : key] = transactions.slice(transactions.indexOf(transactions.filter(it => it.transactionHash === transactionLabels[key])[0]), transactions.indexOf(transactions.filter(it => it.transactionHash === transactionLabels[keys[i]])[0]));
        }
        var key = keys[keys.length - 1];
        transactionLists[key.endsWith(' - ') ? key.split(' - ')[0] : key] = transactions.slice(transactions.indexOf(transactions.filter(it => it.transactionHash === transactionLabels[key])[0]));
        return transactionLists;
    }

    context.attachParentAndTransaction = function attachParentAndTransaction(step, transaction, originalTransaction, parent) {
        parent && (step.parent = parent);
        parent && (step.transaction = transaction);
        step.originalTransaction = originalTransaction;
        if (step.steps && step.steps.length > 0) {
            for (var i in step.steps) {
                step.steps[i] = context.attachParentAndTransaction(step.steps[i], transaction, originalTransaction, step);
            }
        }
        if (step.logs && step.logs.length > 0) {
            for (var i in step.logs) {
                step.logs[i] = context.attachParentAndTransaction(step.logs[i], transaction, originalTransaction, step);
            }
        }
        return step;
    }

    context.prepareAdditionalData = async function prepareAdditionalData(compiledContracts, wellknownAddresses) {
        var remoteAdditionalData = JSON.parse(await (await fetch(window.context.remoteAdditionalDataLink)).text());
        var byBytecode = {};
        var methods = {};
        var logs = {};
        for (var entry of Object.entries({
                ...(remoteAdditionalData.wellKnownContracts || {}),
                ...(compiledContracts || {})
            })) {
            var key = entry[0];
            var name = entry[1].name;
            if(!name) {
                continue;
            }
            var abi = entry[1].abi;
            if(!abi) {
                continue;
            }
            var localMethods = {};
            var localLogs = {};
            abi.filter(it => it.type === 'function').forEach(it => localMethods = context.fillMethods(it, localMethods));
            abi.filter(it => it.type === 'event').forEach(it => localLogs = context.fillLogs(it, localLogs));
            byBytecode[key] = {
                name,
                methods: localMethods,
                logs: localLogs
            };
            methods = {...localMethods, ...methods };
            logs = {...localLogs, ...logs };
        }
        var wellknownAddressesInput = {...(remoteAdditionalData.wellknownAddresses || {}), ...(wellknownAddresses || {}) };
        for (var key of Object.keys(wellknownAddressesInput)) {
            var abi = wellknownAddressesInput[key].abi;
            wellknownAddressesInput[key] = {
                name: wellknownAddressesInput[key].name || wellknownAddressesInput[key]
            };
            abi && (wellknownAddressesInput[key].abi = abi);
        };

        var wellknownAddresses = {};
        Object.entries(wellknownAddressesInput).filter(it => !it[1].abi).forEach(it => wellknownAddresses[it[0]] = {
            ...it[1],
            methods : {},
            logs : {}
        });

        for (var entry of Object.entries(wellknownAddressesInput).filter(it => it[1].abi)) {
            var key = entry[0];
            var name = entry[1].name;
            var abi = entry[1].abi;
            var localMethods = {};
            var localLogs = {};
            abi.filter(it => it.type === 'function').forEach(it => localMethods = context.fillMethods(it, localMethods));
            abi.filter(it => it.type === 'event').forEach(it => localLogs = context.fillLogs(it, localLogs));
            wellknownAddresses[key] = {
                name,
                methods: localMethods,
                logs: localLogs
            };
            methods = {...localMethods, ...methods };
            logs = {...localLogs, ...logs };
        }

        return { byBytecode, wellknownAddresses, methods, logs };
    };

    function parseParam(param) {
        var lab = (param.internalType || param.type).split('struct ').join('').split('.');
        lab = lab[lab.length - 1].trim();
        param.indexed && (lab += ' indexed');
        var name = param.name;
        param.name && (lab += (' ' + param.name));
        var type = param.type;
        var typeForKey = type;
        var complexTypes = [];
        if (param.components) {
            type = 'tuple(';
            typeForKey = "("
            for (var i in param.components) {
                var complexType = parseParam(param.components[i = parseInt(i)]);
                complexTypes.push(complexType);
                type += complexType.type;
                typeForKey += complexType.typeForKey;
                i < (param.components.length - 1) && (type += ',');
                i < (param.components.length - 1) && (typeForKey += ',');
            }
            type += ')';
            typeForKey += ')';
            param.type.indexOf('[]') !== -1 && (type += '[]');
            param.type.indexOf('[]') !== -1 && (typeForKey += '[]');
        }
        return { type, name, complexTypes, lab, typeForKey };
    };

    context.fillMethods = function fillMethods(method, methods) {
        var inputTypes = [];
        var inputNames = [];
        var inputComplexTypes = [];
        var outputTypes = [];
        var outputNames = [];
        var outputComplexTypes = [];
        var label = method.name + "(";
        var key = method.name + "(";
        if (method.inputs && method.inputs.length > 0) {
            for (var i in method.inputs) {
                var { type, name, complexTypes, lab, typeForKey } = parseParam(method.inputs[i = parseInt(i)]);
                inputTypes.push(type);
                inputNames.push(name);
                inputComplexTypes.push(complexTypes);
                label += lab;
                i < (method.inputs.length - 1) && (label += ', ');
                key += typeForKey;
                i < (method.inputs.length - 1) && (key += ',');
            }
        }

        label += ")";

        if (method.outputs && method.outputs.length > 0) {
            label += " returns (";
            for (var i in method.outputs) {
                var { type, name, complexTypes, lab } = parseParam(method.outputs[i = parseInt(i)]);
                outputTypes.push(type);
                outputNames.push(name);
                outputComplexTypes.push(complexTypes);
                label += lab;
                i < (method.outputs.length - 1) && (label += ', ');
            }
            label += ")";
        }

        key = method.signature ? method.signature : web3util.utils.sha3(key + ")").substring(0, 10);

        methods[key] = {
            key,
            label,
            name: method.name,
            inputTypes,
            inputNames,
            inputComplexTypes,
            outputTypes,
            outputNames,
            outputComplexTypes
        };
        return methods;
    };

    context.fillLogs = function fillLogs(log, logs) {
        var key = log.name + "(";
        var label = log.name + "(";
        var inputTypes = [];
        var inputNames = [];
        var topicTypes = [];
        var topicNames = [];
        if (log.inputs && log.inputs.length > 0) {
            for (var i in log.inputs) {
                var input = log.inputs[i = parseInt(i)];
                var { type, name, lab } = parseParam(input);
                !input.indexed && inputTypes.push(type);
                !input.indexed && inputNames.push(name);
                input.indexed && topicTypes.push((type.indexOf("bytes") === -1 && type.indexOf("string") === -1) ? type : "");
                input.indexed && topicNames.push(name);
                label += lab;
                i < (log.inputs.length - 1) && (label += ', ');
                key += type;
                i < (log.inputs.length - 1) && (key += ',');
            }
        }
        key = window.web3util.utils.sha3(key + ")");
        logs[key] = {
            key,
            label: label + ")",
            name: log.name,
            inputTypes,
            inputNames,
            topicTypes,
            topicNames
        };
        return logs;
    };
};;var Index=React.createClass({displayName:"Index",requiredModules:["spa/config","spa/transactions","spa/selectedTransaction"],requiredScripts:["assets/scripts/codeDecoder.js"],getDefaultSubscriptions:function(){return{dump:this.controller.onDump}},render:function(){function c(e,t){l(t),u(e)}var t=useState(this,null,"additionalData"),n=t[0],r=useState(this,null,"transactions"),i=r[0],s=useState(this,null,"selectedTransaction"),o=s[0],u=s[1],a=useState(this,null),f=a[0],l=a[1];return React.createElement(React.Fragment,null,React.createElement(Config,null),o&&React.createElement(SelectedTransaction,{additionalData:n,transaction:o,transactionsList:f,onTransaction:c}),!o&&(!i||i.length===0)&&React.createElement("h1",{className:"w3-container"},"No Transactions right now"),!o&&i&&i.length>0&&(!n||!n.transactionLists)&&React.createElement(Transactions,{additionalData:n,transactions:i,onTransaction:u}),!o&&i&&i.length>0&&n&&n.transactionLists&&Object.entries(n.transactionLists).map(function(e){return React.createElement(Transactions,{title:e[0],additionalData:n,transactions:e[1],onTransaction:function(n){return c(n,e[1])}})}))}});var SelectedTransactionController = function(view) {
    var context = this;
    context.view = view;
};;function _extends(){return _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_extends.apply(this,arguments)}var StepDetail=React.createClass({displayName:"StepDetail",requiredScripts:["assets/scripts/codeDecoder.js","spa/components/address.jsx","spa/components/tag.jsx"],renderColor:function(){var t=this.props.step,n=t.parent?t.parent.from+t.parent.to+t.parent.type+t.parent.data+t.parent.result:"";return web3.utils.sha3(n+t.from+t.to+t.type+t.data+t.result).substring(2,5)},renderSubSteps:function(t,n,r,i){var s=[];return s=[].concat(t.steps||[],t.logs||[]).reduce(function(e,t){var n;return _extends({},e,(n={},n[t.index]=t,n))},{}),s=Object.keys(s).sort(function(e,t){return parseInt(e)-parseInt(t)}).map(function(e){return s[e]}),s.map(function(e,t){return React.createElement(StepDetail,{key:t,step:e,additionalData:n,showAll:r,bypassDelegateCalls:i})})},render:function(){var t=this.props,n=t.step,r=t.additionalData,i=t.showAll,s=t.bypassDelegateCalls,o=useState(this,i),u=o[0],a=o[1];useEffect(this,function(){return a(i)},[i]);var f="#"+this.renderColor(),l=this.renderSubSteps(n,r,i,s);return s&&n.type==="DELEGATECALL"?l:React.createElement("div",{className:"w3-panel"+(n.parent?" w3-margin-left":""),style:{"border-color":f}},n.type!=="LOG"&&React.createElement("p",null,"From ",React.createElement(Address,{value:n.from,address:CodeDecoder.decodeAddress(n.from,n.fromCodeHash,r),isContract:n.fromCodeHash})," to ",React.createElement(Address,{value:n.to,address:CodeDecoder.decodeAddress(n.to,n.toCodeHash,r),isContract:n.toCodeHash})),React.createElement("a",{onClick:function(){return a(!u)},style:{cursor:"pointer"}},React.createElement("p",null,React.createElement("span",{style:{"font-weight":!u||(n.type==="CREATE"||n.type==="CREATE2"||n.type==="TRANSFER")&&!i?"bolder":"normal"}},React.createElement("i",{className:"fa fa-"+(n.type==="LOG"?"bullhorn":"arrow-right-arrow-left")})," ",n.type==="LOG"?CodeDecoder.decodeLog(n,r,!0):CodeDecoder.decodeMethodLabel(n,r,!0))," ","|"," ",React.createElement(Tag,null,n.type),n.type!=="LOG"&&React.createElement(React.Fragment,null," ","|"," ",React.createElement(Tag,{color:n.success?"green":"red",icon:n.success?"check":"times"},n.success?"SUCCESS":"FAILED"),n.incomplete&&React.createElement(React.Fragment,null,React.createElement("span",null," "),React.createElement(Tag,{color:"khaki",icon:"warning"},"NOT RELIABLE STACK"))))),React.createElement("p",null,(n.type==="CALL"||n.type==="CREATE"||n.type==="CREATE2"||n.type==="TRANSFER")&&(u||n.gasUsed)&&React.createElement("span",null,"Value: ",window.fromDecimals(n.value,18,!0)," ETH"),n.gasUsed&&React.createElement("span",null," Gas: ",window.formatMoney(n.gas)),n.gasUsed&&React.createElement("span",null," Gas Used: ",window.formatMoney(n.gasUsed)),n.gasPrice&&React.createElement("span",null," Gas Price: ",window.fromDecimals(n.gasPrice,9,!0)," GWEI")),n.type!=="LOG"&&u&&React.createElement("p",null,n.type!=="CREATE"&&n.type!=="CREATE2"&&n.type!=="TRANSFER"&&React.createElement(React.Fragment,null,React.createElement("h5",null,React.createElement("b",null,"Method")),React.createElement("h6",null,React.createElement("span",{className:"w3-code"},CodeDecoder.decodeMethodLabel(n,r))),n.params&&n.params!=="0x"&&React.createElement(React.Fragment,null,React.createElement("h6",null,"Input"),React.createElement("div",{className:"w3-code w3-border-gray w3-light-gray",ref:function(t){return t&&(t.innerHTML=CodeDecoder.decodeMethodInput(n,r))}}))),(n.result&&n.result!=="0x"||!n.success)&&u&&React.createElement(React.Fragment,null,React.createElement("h6",null,"Output"),React.createElement("div",{className:"w3-code w3-border-gray w3-light-gray",ref:function(t){return t&&(t.innerHTML=CodeDecoder.decodeMethodOutput(n,r))}}))),n.type==="LOG"&&u&&React.createElement("p",null,React.createElement("h5",null,React.createElement("b",null,"Event")),React.createElement("div",{className:"w3-container"},React.createElement("h6",null,React.createElement("span",{className:"w3-code"},CodeDecoder.decodeLog(n,r))),React.createElement("p",null,"Launcher: ",React.createElement(Address,{value:n.address,address:CodeDecoder.decodeAddress(n.address,n.addressCodeHash,r),isContract:n.addressCodeHash})),React.createElement("h6",null,"Parameters"),React.createElement("div",{className:"w3-code w3-border-gray w3-light-gray",ref:function(t){return t&&(t.innerHTML=CodeDecoder.decodeLogInput(n,r))}}))),l)}});var SelectedTransaction=React.createClass({displayName:"SelectedTransaction",requiredScripts:["spa/components/address.jsx","spa/components/tag.jsx","spa/selectedTransaction/stepDetail.jsx"],render:function(){var t=useState(this,!1),n=t[0],r=t[1],i=useState(this,!1),s=i[0],o=i[1],u=this,a=this.props.transaction,f=this.props.transactionsList,l=this.props.additionalData,c=f.indexOf(a),h=c>0&&function(){return u.props.onTransaction(f[c-1],f)},p=c<f.length-1&&function(){return u.props.onTransaction(f[c+1],f)};return React.createElement("div",{className:"w3-container"},React.createElement("div",{className:"w3-container"},React.createElement("div",{className:"w3-container w3-left"},React.createElement("a",{className:"w3-button",href:"javascript:;",onClick:function(){return u.props.onTransaction()}},React.createElement("i",{className:"fa fa-arrow-left"})," ","Back")),React.createElement("div",{className:"w3-container w3-right"},React.createElement("a",{className:"w3-button"+(h?"":" w3-disabled"),href:"javascript:;",onClick:h},React.createElement("i",{className:"fa fa-arrow-left"})," ","Prev")," ",React.createElement("span",null,c+1," of ",f.length)," ",React.createElement("a",{className:"w3-button"+(p?"":" w3-disabled"),href:"javascript:;",onClick:p},"Next"," ",React.createElement("i",{className:"fa fa-arrow-right"})))),React.createElement("h3",null,"Transaction ",React.createElement("a",{target:"_blank",href:window.getEtherscanAddress("tx/"+a.transactionHash)},a.transactionHash)," | Block: #",a.blockNumber,a.blockTimestamp&&React.createElement(React.Fragment,null," | Mined at: ",(new Date(a.blockTimestamp*1e3)).toLocaleString())),React.createElement("p",null,React.createElement("label",null,"Show all"," ",React.createElement("input",{type:"radio",onChange:function(){return r(!0)},checked:n}))," ",React.createElement("label",null,"Collapse all"," ",React.createElement("input",{type:"radio",onChange:function(){return r(!1)},checked:!n}))," ",React.createElement("label",null,"Bypass DELEGATECALL"," ",React.createElement("input",{type:"checkbox",onChange:function(t){return o(t.currentTarget.checked)},checked:s}))),React.createElement(StepDetail,{step:a,additionalData:l,showAll:n,bypassDelegateCalls:s}))}});var TransactionsController = function(view) {
    var context = this;
    context.view = view;
};;var Transactions=React.createClass({displayName:"Transactions",requiredScripts:["assets/scripts/codeDecoder.js","spa/components/address.jsx","spa/components/tag.jsx"],render:function(){var t=this,n=this;return React.createElement("div",{className:"w3-container"},React.createElement("h2",null,this.props.title||"Transactions"),React.createElement("table",{className:"w3-table-all w3-hoverable"},React.createElement("thead",null,React.createElement("tr",{className:"w3-theme"},React.createElement("th",null,"Txn Hash"),React.createElement("th",null,"Method"),React.createElement("th",null,"Block"),this.props.transactions[0].blockTimestamp&&React.createElement("th",null,"Date"),React.createElement("th",null,"From"),React.createElement("th",null,"To"),React.createElement("th",null," "))),React.createElement("tbody",null,this.props.transactions.map(function(e){return React.createElement("tr",{style:{cursor:"pointer"},onClick:function(){return t.props.onTransaction(e)},key:e.transactionHash,id:"txn_"+e.transactionHash},React.createElement("td",null,React.createElement("a",{href:"#txn_"+e.transactionHash,onClick:function(){return t.props.onTransaction(e)}},window.shortenWord(e.transactionHash,15))),React.createElement("td",null,React.createElement(Tag,{bold:!e.method||e.method==="0x"||!e.parent&&e.type!=="CALL"},CodeDecoder.decodeMethodLabel(e,n.props.additionalData,!0))),React.createElement("td",null,"# ",React.createElement("a",{target:"_blank",href:window.getEtherscanAddress("block/"+e.blockNumber)},e.blockNumber)),e.blockTimestamp&&React.createElement("td",null,(new Date(e.blockTimestamp*1e3)).toLocaleString()),React.createElement("td",null,React.createElement(Address,{value:e.from,address:CodeDecoder.decodeAddress(e.from,e.fromCodeHash,n.props.additionalData,!0),isContract:e.fromCodeHash,shorten:!0})),React.createElement("td",null,React.createElement(Address,{value:e.to,address:CodeDecoder.decodeAddress(e.to,e.toCodeHash,n.props.additionalData,!0),isContract:e.toCodeHash,shorten:!0})),React.createElement("td",null,React.createElement(Tag,{color:e.success?"green":"red",icon:e.success?"check":"times"},e.success?"SUCCESS":"FAILED",e.incomplete&&React.createElement(React.Fragment,null," ",React.createElement("i",{className:"fa fa-warning w3-right",style:{color:"khaki"}})))))}))))}});